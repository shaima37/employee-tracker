name: CI - Build and Test

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: windows-latest

    steps:
    # 1 Get source code
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2 Setup MSBuild for .NET Framework
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2
      with:
        vs-version: '[16.0,)'

    # 3 Setup VSTest (MSTest runner)
    - name: Setup VSTest
      uses: darenm/Setup-VSTest@v1

    # 4 Restore NuGet dependencies (if used)
    - name: Restore NuGet packages
      run: nuget restore EmployeeTracker.sln

    # 5 Build the solution
    - name: Build solution
      run: msbuild EmployeeTracker.sln /p:Configuration=Release

    # 6 Run Unit and Integration Tests
    - name: Run MSTest
      run: |
        vstest.console.exe EmployeeTrackerTests\bin\Release\EmployeeTrackerTests.dll /logger:trx

    # 7 Upload test results (for inspection)
    - name: Upload Test Results
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: MSTest-Results
        path: TestResults/*.trx
