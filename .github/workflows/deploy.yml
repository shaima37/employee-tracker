name: CD - Deploy Application

on:
  workflow_run:
    workflows: ["CI - Build and Test"]
    types:
      - completed

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: windows-latest

    steps:
    # 1 Download source again (or artifact from CI)
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2 Setup MSBuild for deployment build
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    # 3 Build solution again (or reuse artifact)
    - name: Build for Deployment
      run: msbuild EmployeeTracker.sln /p:Configuration=Release

    # 4 Create Deployment Folder
    - name: Prepare Deployment Files
      run: |
        echo "Preparing deployment package..."
        mkdir Deploy
        copy EmployeeTracker\bin\Release\*.exe Deploy\
        echo "Files ready for deployment."

    # 5 Upload deployable build as artifact
    - name: Upload Deployment Artifact
      uses: actions/upload-artifact@v3
      with:
        name: EmployeeTracker-Build
        path: Deploy/

    # 6 (Optional) Simulate or push to real environment
    # Replace with actual deploy target later (e.g., Azure)
    - name: Simulate Deployment
      run: |
        echo "âœ… Deploying Employee Tracker build..."
        echo "Deployment completed successfully!"
